{% extends 'base.html.twig' %}

{% block title %}{{ 'title.admin_panel'|trans }}{% endblock %}

{% block body %}
<h1>{{ 'title.admin_panel'|trans }}</h1>

{# Wybór sekcji #}
<form method="get" class="mb-3">
    <label for="sectionSelect">{{ 'label.select_section'|trans }}</label>
    <select id="sectionSelect" name="section" onchange="this.form.submit()" class="form-select w-auto d-inline-block">
        <option value="posts" {{ section == 'posts' ? 'selected' : '' }}>{{ 'label.posts'|trans }}</option>
        <option value="categories" {{ section == 'categories' ? 'selected' : '' }}>{{ 'label.categories'|trans }}</option>
        <option value="comments" {{ section == 'comments' ? 'selected' : '' }}>{{ 'label.comments'|trans }}</option>
    </select>
</form>

{# Przycisk "Dodaj" nad listą, tylko dla postów i kategorii #}
{% if section == 'posts' %}
    <a href="{{ path('post_new') }}" class="btn btn-success mb-3">{{ 'button.add_post'|trans }}</a>
{% elseif section == 'categories' %}
    <a href="{{ path('categories_new') }}" class="btn btn-success mb-3">{{ 'button.add_category'|trans }}</a>
{% endif %}

{# Lista elementów #}
<ul class="list-group mb-3">
    {% for item in pagination %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            {% if section == 'posts' %}
                {{ item.title }}
                <div class="btn-group">
                    <a href="{{ path('post_edit', {'id': item.id}) }}" class="btn btn-primary btn-sm">{{ 'button.edit'|trans }}</a>
                    <form method="post" action="{{ path('post_delete', {'id': item.id}) }}" onsubmit="return confirm('{{ 'message.confirm_delete_post'|trans }}');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ item.id) }}">
                        <button class="btn btn-danger btn-sm">{{ 'button.delete'|trans }}</button>
                    </form>
                </div>
            {% elseif section == 'categories' %}
                {{ item.name }}
                <div class="btn-group">
                    <a href="{{ path('categories_edit', {'id': item.id}) }}" class="btn btn-primary btn-sm">{{ 'button.edit'|trans }}</a>
                    <form method="post" action="{{ path('categories_delete', {'id': item.id}) }}" onsubmit="return confirm('{{ 'message.confirm_delete_category'|trans }}');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ item.id) }}">
                        <button class="btn btn-danger btn-sm">{{ 'button.delete'|trans }}</button>
                    </form>
                </div>
            {% elseif section == 'comments' %}
                <div>
                    <strong>{{ item.nickname }}</strong> {{ 'text.in_post'|trans }} <em>{{ item.post.title }}</em> —
                    {{ item.content|length > 50 ? item.content|slice(0, 50) ~ '...' : item.content }}
                </div>
                <form method="post" action="{{ path('comment_delete', {'id': item.id}) }}" onsubmit="return confirm('{{ 'message.confirm_delete_comment'|trans }}');">
                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ item.id) }}">
                    <button class="btn btn-danger btn-sm">{{ 'button.delete'|trans }}</button>
                </form>
            {% endif %}
        </li>
    {% else %}
        <li class="list-group-item">
            {{ ('message.no_' ~ section|lower)|trans }}
        </li>
    {% endfor %}
</ul>

{# Paginacja #}
{{ knp_pagination_render(pagination, '@KnpPaginator/Pagination/bootstrap_v5_pagination.html.twig') }}

{% endblock %}
